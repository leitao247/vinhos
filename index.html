<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catálogo S&P — Vinhos e Harmonizador</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;line-height:1.4}
    body{max-width:1200px;margin:20px auto;padding:18px;background:#f6f7fb;color:#111}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{margin:0;font-size:1.25rem}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input,select,button{padding:8px;border:1px solid #d1d5db;border-radius:6px}
    .families{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;margin-top:18px}
    .family{background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 6px rgba(16,24,40,.06);display:flex;flex-direction:column;gap:10px}
    .family .img{height:160px;background:#fff;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center;border:1px solid #eef2f7}
    .family h2{margin:0;font-size:1rem;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .list{margin:0;padding:0;list-style:none;max-height:260px;overflow:auto}
    .list li{padding:6px 0;border-bottom:1px solid #f1f5f9;font-size:0.95rem}
    .muted{color:#6b7280;font-size:0.9rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-top:18px}
    .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 6px rgba(16,24,40,.06)}
    .thumb{height:160px;background:#f3f4f6;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    pre{background:#0f172a;color:#fff;padding:12px;border-radius:6px;overflow:auto;max-height:320px}
    footer{margin-top:18px;color:#6b7280;font-size:0.9rem}
    .badge{background:#eef2ff;color:#1e3a8a;padding:4px 8px;border-radius:999px;font-weight:600}
    /* Harmonization SVG styling */
    .harmo-svg{width:100%;height:160px;display:block}
    .harmo-panel{background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 6px rgba(16,24,40,.04);margin-top:12px}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Catálogo S&P — Vinhos e Harmonizador</h1>
      <div class="muted">Exibe nomes por família; a imagem de rótulo foi substituída por um ícone de harmonização (chef + sommelier + enólogo).</div>
    </div>

    <div class="controls">
      <input id="search" placeholder="Pesquisar por nome de vinho" style="width:300px" />
      <select id="filterFamily"><option value="">Todas as famílias</option></select>
      <button id="btnShowAll">Mostrar Todos</button>
    </div>
  </header>

  <section id="info" style="margin-top:12px;background:#fff;padding:10px;border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,.04)">
    <strong>Total de rótulos:</strong> <span id="totalCount">0</span>
    &nbsp;•&nbsp;
    <strong>Famílias:</strong> <span id="familyCount">0</span>
  </section>

  <main>
    <section id="families" class="families" aria-live="polite"></section>
  </main>

  <hr style="margin:18px 0" />

  <section class="harmo-panel" aria-live="polite">
    <h2 style="margin:0 0 8px">Harmonização guiada</h2>
    <div class="muted" style="margin-bottom:8px">Quando você escolher um prato, o chef, o sommelier e o enólogo colaboram para sugerir a melhor harmonização.</div>

    <!-- Inline SVG representando Chef + Sommelier + Enólogo (substitui foto do vinho) -->
    <svg class="harmo-svg" viewBox="0 0 1200 300" role="img" aria-label="Ícone de harmonização: chef, sommelier e enólogo">
      <defs>
        <linearGradient id="g1" x1="0" x2="1">
          <stop offset="0" stop-color="#fef3c7"/>
          <stop offset="1" stop-color="#fee2e2"/>
        </linearGradient>
        <linearGradient id="g2" x1="0" x2="1">
          <stop offset="0" stop-color="#dbeafe"/>
          <stop offset="1" stop-color="#e9d5ff"/>
        </linearGradient>
      </defs>

      <!-- background -->
      <rect x="0" y="0" width="1200" height="300" fill="#ffffff"/>

      <!-- Chef (left) -->
      <g transform="translate(120,40)">
        <rect x="-100" y="-20" width="240" height="220" rx="18" fill="#fff" stroke="#eef2f7"/>
        <circle cx="20" cy="40" r="36" fill="#fde68a" stroke="#f59e0b" />
        <rect x="-10" y="80" width="60" height="80" rx="8" fill="#fff" stroke="#f3f4f6"/>
        <path d="M-20 170 q40 30 80 0" fill="#f3f4f6"/>
        <text x="20" y="220" font-size="18" text-anchor="middle" fill="#374151">Chef</text>
      </g>

      <!-- Sommelier (center) -->
      <g transform="translate(520,20)">
        <rect x="-120" y="-10" width="240" height="240" rx="18" fill="#fff" stroke="#eef2f7"/>
        <ellipse cx="0" cy="60" rx="36" ry="36" fill="#fce7f3" stroke="#db2777"/>
        <rect x="-30" y="110" width="60" height="70" rx="8" fill="#fff" stroke="#f3f4f6"/>
        <!-- wine glass icon -->
        <g transform="translate(0,40)">
          <path d="M0 0 q20 30 0 60 q-20 -30 0 -60 z" fill="#fff" stroke="#7c3aed"/>
          <rect x="-6" y="60" width="12" height="40" fill="#7c3aed"/>
          <rect x="-18" y="100" width="36" height="8" rx="4" fill="#7c3aed"/>
        </g>
        <text x="0" y="230" font-size="18" text-anchor="middle" fill="#374151">Sommelier</text>
      </g>

      <!-- Enólogo (right) -->
      <g transform="translate(920,40)">
        <rect x="-100" y="-20" width="240" height="220" rx="18" fill="#fff" stroke="#eef2f7"/>
        <circle cx="20" cy="40" r="36" fill="#dbeafe" stroke="#2563eb" />
        <rect x="-10" y="80" width="60" height="80" rx="8" fill="#fff" stroke="#f3f4f6"/>
        <!-- grape cluster -->
        <g transform="translate(20,120)">
          <circle cx="-18" cy="-10" r="10" fill="#7c3aed"/>
          <circle cx="0" cy="-6" r="12" fill="#6d28d9"/>
          <circle cx="18" cy="-10" r="10" fill="#7c3aed"/>
          <path d="M0 6 q0 12 -6 18" stroke="#4b5563" stroke-width="2" fill="none"/>
        </g>
        <text x="20" y="220" font-size="18" text-anchor="middle" fill="#374151">Enólogo</text>
      </g>

      <!-- central message -->
      <g transform="translate(600,260)">
        <rect x="-420" y="-40" width="840" height="48" rx="8" fill="#111827" opacity="0.06"/>
        <text x="0" y="0" font-size="20" text-anchor="middle" fill="#111827">Harmonização colaborativa: Chef + Sommelier + Enólogo</text>
      </g>
    </svg>

    <div style="margin-top:12px">
      <label for="wineSelectHarmo" class="muted">Escolha um rótulo para iniciar a sugestão:</label>
      <select id="wineSelectHarmo" style="width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;margin-top:6px"></select>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="btnSearchHarmo">Buscar Top 3</button>
        <button id="btnRandomHarmo">Aleatório</button>
      </div>
    </div>
  </section>

  <section style="margin-top:12px">
    <div id="status" class="muted">Pronto. Selecione um rótulo e clique em Buscar Top 3.</div>
    <main id="results" class="grid" style="margin-top:12px"></main>
  </section>

  <footer>
    <div class="muted">Se quiser que eu altere o estilo do ícone (cores, texto, layout) eu atualizo o SVG conforme preferir.</div>
  </footer>

  <script>
    /* ====== Dados (mantidos) ====== */
    const PRODUCTS = [
      {"code":"3000211","product":"Gaggiarone Vitgni Giovani Tto - Croatina","family":"Gaggiarone"},
      {"code":"3000420","product":"Gaggiarone Vitgni Giovani Tto - Croatina","family":"Gaggiarone"},
      {"code":"208","product":"Ca Montebello Tto DOC - Pinot Nero","family":"Ca Montebello"},
      {"code":"284","product":"Ca Montebello Bco DOC - Pinot Nero Bianco","family":"Ca Montebello"},
      {"code":"3000209","product":"Ca Montebello Bco IGT - Pinot Grigio","family":"Ca Montebello"},
      {"code":"3000210","product":"Ca Montebello Tto DOC - Barbera, Uva Rara","family":"Ca Montebello"},
      {"code":"290","product":"Neroperso Rosso Veneto IGT - Apassimento","family":"Neroperso"},
      {"code":"3000291","product":"Liburna DOC Sicilia Tto - Nero d'Avola","family":"Liburna"},
      {"code":"3000288","product":"Borgo del Filari DOC d'Abruzzo - Montepulciano","family":"Borgo del Filari"},
      {"code":"355","product":"La Fogliata di Puglia - Primitivo","family":"La Fogliata"},
      {"code":"3000388","product":"Torre Romanica - Rosso","family":"Torre Romanica"},
      {"code":"405","product":"Torre Romanica - Bianco","family":"Torre Romanica"},
      {"code":"3000405","product":"Torre Romanica - Bianco","family":"Torre Romanica"},
      {"code":"422","product":"Torre Romanica - Rosato","family":"Torre Romanica"},
      {"code":"3000422","product":"Torre Romanica - Rosato","family":"Torre Romanica"},
      {"code":"3000406","product":"Torre Romanica Tto - Sangiovese","family":"Torre Romanica"},
      {"code":"3000428","product":"Torre Romanica Pinot Grigio","family":"Torre Romanica"},
      {"code":"3000389","product":"Torre Romanica Puglia - Primitivo","family":"Torre Romanica"},
      {"code":"397","product":"Torre Romanica Premium - Montepulciano","family":"Torre Romanica"},
      {"code":"413","product":"Le Cime Passito IGT – Garganega, Moscato Amarelo","family":"Le Cime"},
      {"code":"412","product":"Carpino Garda DOC – Merlot","family":"Carpino"},
      {"code":"216","product":"Ribó Garda DOC - Cabernet Franc, Cabernet Sauvignon","family":"Ribó"},
      {"code":"415","product":"Meridiano Garda DOC – Chardonnay","family":"Meridiano"},
      {"code":"414","product":"Lugana DOC – Turbiana","family":"Lugana"},
      {"code":"408","product":"Cornalino Rosso IGT Alto Mincio – Merlot, Cabernet","family":"Cornalino"},
      {"code":"407","product":"I Ciottoli Garda DOC – Cabernet Franc, Cab. Sauvignon","family":"I Ciottoli"},
      {"code":"411","product":"Le Mure Garda DOC – Chardonnay","family":"Le Mure"},
      {"code":"215","product":"Mandorlo Bianco IGT Mantova – Tocai Friulano","family":"Mandorlo"},
      {"code":"410","product":"La Casina Bianco Garda DOC – Garganega, Trebbiano, Chardonnay","family":"La Casina"},
      {"code":"214","product":"La Casina Chiaretto Garda DOC – Merlot, Cabernet, Rondinella","family":"La Casina"},
      {"code":"409","product":"La Casina Rosso Garda DOC – Merlot, Rondinella, Cab. Sauvignon, Sangiovese","family":"La Casina"},
      {"code":"3000221","product":"Dirty Rabbit Tto - Petit Verdot","family":"Rabbit"},
      {"code":"220","product":"Charming Rabbit Bco - Chardonnay","family":"Rabbit"},
      {"code":"3000222","product":"Mrs. Rabbit Tto - Pinot Noir","family":"Rabbit"},
      {"code":"245","product":"Pink Rabbit Rosé - Grenache, Syrah","family":"Rabbit"},
      {"code":"223","product":"Mr. Rabbit Tto - Cabernet Sauvignon","family":"Rabbit"},
      {"code":"224","product":"Master Rabbit Tto - Syrah","family":"Rabbit"},
      {"code":"272","product":"Spring Rabbit Bco - Sauvignon Blanc","family":"Rabbit"},
      {"code":"225","product":"Chatelain Valmont Cotes du Rhone Tto - Grenache Syrah","family":"Chatelain"},
      {"code":"3000444","product":"Pescada Branco, DOC Verde","family":"Pescada"},
      {"code":"3000467","product":"Pescada Rosé, DOC Verde","family":"Pescada"},
      {"code":"445","product":"Pescada - Arinto e Trajadura","family":"Pescada"},
      {"code":"446","product":"Pescada - 100% Alvarinho","family":"Pescada"},
      {"code":"171","product":"Porta 6 Tto meia garrafa","family":"Porta 6"},
      {"code":"172","product":"Porta 6 Bco meia garrafa","family":"Porta 6"},
      {"code":"130","product":"Espumante Porta 6 Bco Brut","family":"Porta 6"},
      {"code":"160","product":"Vinho Verde Porta 6 DOC","family":"Porta 6"},
      {"code":"3000160","product":"Vinho Verde Porta 6 DOC","family":"Porta 6"},
      {"code":"931","product":"Porta 6 Bco","family":"Porta 6"},
      {"code":"300093","product":"Porta 6 Bco","family":"Porta 6"},
      {"code":"185","product":"Porta 6 Rosé","family":"Porta 6"},
      {"code":"300078","product":"Porta 6 Tto","family":"Porta 6"},
      {"code":"170","product":"Porta 6 Reserva Tto","family":"Porta 6"},
      {"code":"3000157","product":"Porta 6 Magnum Tto","family":"Porta 6"},
      {"code":"3000250","product":"Porta 6 Double Magnum Tto","family":"Porta 6"},
      {"code":"3000173","product":"Bag in Box Porta 6 Tto","family":"Porta 6"},
      {"code":"3000466","product":"Bag in Box Porta 6 Bco","family":"Porta 6"},
      {"code":"3000296","product":"Pack 2un - Porta 6 Tto","family":"Porta 6"},
      {"code":"3000400","product":"Pack 2un - (1 Porta 6 Tto 1 Porta 6 Bco)","family":"Porta 6"},
      {"code":"3000348","product":"Porta 6 Bitube Tto","family":"Porta 6"},
      {"code":"110","product":"Dom Dinis Reserva Tto","family":"Dom Dinis"},
      {"code":"161","product":"Dom Dinis Mesa Bco","family":"Dom Dinis"},
      {"code":"39","product":"Reserva dos Amigos Tinto","family":"Reserva dos Amigos"},
      {"code":"83","product":"Reserva dos Amigos Magnum Tto","family":"Reserva dos Amigos"},
      {"code":"162","product":"Reserva dos Amigos Seleção Especial Tto","family":"Reserva dos Amigos"},
      {"code":"3000163","product":"Bag in Box Branco dos Amigos","family":"Reserva dos Amigos"},
      {"code":"97","product":"Bag in Box Tinto dos Amigos","family":"Reserva dos Amigos"},
      {"code":"120","product":"3 Autores Verde DOC Branco","family":"3 Autores"},
      {"code":"96","product":"3 Autores Douro DOC Tinto","family":"3 Autores"},
      {"code":"246","product":"3 Autores Douro DOC Branco","family":"3 Autores"},
      {"code":"114","product":"3 Autores Grande Reserva Tto","family":"3 Autores"},
      {"code":"3000116","product":"Coragem Superior Tto","family":"Coragem"},
      {"code":"115","product":"Coragem Superior Bco","family":"Coragem"},
      {"code":"178","product":"Coragem Reserva Tto","family":"Coragem"},
      {"code":"180","product":"Coragem Regional Lisboa Tto","family":"Coragem"},
      {"code":"111","product":"N.B.N.C No Branding No Cry Tto (Vidigal)","family":"Vidigal"},
      {"code":"300046","product":"Brutalis by Vidigal Tto","family":"Vidigal"},
      {"code":"3000297","product":"Brutalis by Vidigal Tto","family":"Vidigal"},
      {"code":"41","product":"Vidigal Reserva Tto","family":"Vidigal"},
      {"code":"300043","product":"Vidigal Single Grape Tto - Touriga Nacional","family":"Vidigal"},
      {"code":"159","product":"Vidigal Chapeu de Praia Rosé","family":"Vidigal"},
      {"code":"326","product":"Zé do Telhado DOC Douro","family":"Vidigal"},
      {"code":"333","product":"Boa Noite Lisboa Tinto","family":"Boa Noite Lisboa"},
      {"code":"334","product":"Boa Noite Lisboa Branco","family":"Boa Noite Lisboa"},
      {"code":"344","product":"Boa Noite Lisboa Rosé","family":"Boa Noite Lisboa"},
      {"code":"3000154","product":"Júlia Florista Tto","family":"Júlia Florista"},
      {"code":"3000181","product":"Júlia Florista Bco","family":"Júlia Florista"},
      {"code":"3000346","product":"Júlia Florista Rosé","family":"Júlia Florista"},
      {"code":"3000345","product":"Júlia Florista Reserva Tto","family":"Júlia Florista"},
      {"code":"3000196","product":"Bag in Box Júlia Florista Bco","family":"Júlia Florista"},
      {"code":"3000179","product":"Bag in Box Júlia Florista Tto","family":"Júlia Florista"},
      {"code":"347","product":"Júlia Florista Bitube Tto","family":"Júlia Florista"},
      {"code":"232","product":"Artolas Reserva Tto","family":"Artolas"},
      {"code":"153","product":"Artolas Tinto","family":"Artolas"},
      {"code":"158","product":"Artolas Branco","family":"Artolas"},
      {"code":"3000233","product":"Artolas Rosé","family":"Artolas"},
      {"code":"90","product":"Da Pipa Branco","family":"Da Pipa"},
      {"code":"3000273","product":"Da Pipa Tinto","family":"Da Pipa"},
      {"code":"298","product":"Da Pipa Rosé","family":"Da Pipa"},
      {"code":"241","product":"Da Pipa Branco","family":"Da Pipa"},
      {"code":"247","product":"Da Pipa Rosé","family":"Da Pipa"},
      {"code":"3000242","product":"Da Pipa Tinto","family":"Da Pipa"},
      {"code":"358","product":"Da Pipa Frisante Branco","family":"Da Pipa"},
      {"code":"359","product":"Da Pipa Frisante Rosé","family":"Da Pipa"},
      {"code":"356","product":"Da Pipa Espumante Branco (Blanc de Blancs)","family":"Da Pipa"},
      {"code":"357","product":"Da Pipa Espumante Rosé","family":"Da Pipa"},
      {"code":"3000243","product":"Da Pipa Bag in Box Bco","family":"Da Pipa"},
      {"code":"3000248","product":"Da Pipa Bag in Box Rosé","family":"Da Pipa"},
      {"code":"3000244","product":"Da Pipa Bag in Box Tto","family":"Da Pipa"},
      {"code":"266","product":"Da Pipa Reserva IG Bco","family":"Da Pipa"},
      {"code":"3000267","product":"Da Pipa Reserva IG Tto","family":"Da Pipa"},
      {"code":"3000268","product":"Da Pipa Colheita Selecionada Tto","family":"Da Pipa"},
      {"code":"270","product":"Da Pipa Signature Bco","family":"Da Pipa"},
      {"code":"3000314","product":"Fonte da Perdiz Reserva Tinto - Douro DOC","family":"Fonte da Perdiz"},
      {"code":"3000317","product":"Fonte da Perdiz Tinto - Douro DOC","family":"Fonte da Perdiz"},
      {"code":"3000315","product":"Fonte da Perdiz Branco - Douro DOC","family":"Fonte da Perdiz"},
      {"code":"3000427","product":"Fonte da Perdiz Superior Tinto","family":"Fonte da Perdiz"},
      {"code":"3000327","product":"Intimista Tinto","family":"Amareleza"},
      {"code":"3000343","product":"Intimista Branco","family":"Amareleza"},
      {"code":"3000310","product":"Intimista Rosé","family":"Amareleza"},
      {"code":"3000299","product":"Eruptio Blend Açores D.O Pico","family":"Eruptio"},
      {"code":"3000300","product":"Eruptio Arinto D.O Pico","family":"Eruptio"},
      {"code":"3000301","product":"Eruptio Verdelho D.O Pico","family":"Eruptio"},
      {"code":"3000354","product":"Moscatel do Douro - Martha's","family":"Martha's"},
      {"code":"3000350","product":"Porto White - Martha's","family":"Martha's"},
      {"code":"3000351","product":"Porto Ruby - Martha's","family":"Martha's"},
      {"code":"3000423","product":"Porto Rosé - Martha's","family":"Martha's"},
      {"code":"353","product":"Porto 10 anos - Martha's","family":"Martha's"},
      {"code":"423","product":"Porto 20 anos - Martha's","family":"Martha's"},
      {"code":"3000360","product":"Isla Negra Reserva - Cabernet Sauvignon","family":"Isla Negra"},
      {"code":"3000361","product":"Isla Negra Reserva - Carmenere","family":"Isla Negra"},
      {"code":"3000362","product":"Isla Negra Reserva - Merlot","family":"Isla Negra"},
      {"code":"3000363","product":"Isla Negra Reserva - Sauvignon Blanc","family":"Isla Negra"},
      {"code":"3000263","product":"New Roads Tto - Malbec, Tempranillo, Bonarda","family":"New Roads"},
      {"code":"3000271","product":"New Roads Bco - Ugni Blanc, Chenin, Pedro Gimenez","family":"New Roads"},
      {"code":"456","product":"New Roads Tto - Malbec 100%","family":"New Roads"},
      {"code":"382","product":"Viñas del Tango Rosé","family":"Viñas del Tango"},
      {"code":"381","product":"Viñas del Tango Varietal - Chardonnay","family":"Viñas del Tango"},
      {"code":"3000404","product":"Viñas del Tango Varietal - Torrontes","family":"Viñas del Tango"},
      {"code":"3000402","product":"Viñas del Tango Varietal - Cabernet Franc","family":"Viñas del Tango"},
      {"code":"403","product":"Viñas del Tango Varietal - Cabernet Sauvignon","family":"Viñas del Tango"},
      {"code":"3000403","product":"Viñas del Tango Varietal - Cabernet Sauvignon","family":"Viñas del Tango"},
      {"code":"383","product":"Viñas del Tango Varietal - Malbec","family":"Viñas del Tango"},
      {"code":"3000383","product":"Viñas del Tango Varietal - Malbec","family":"Viñas del Tango"},
      {"code":"385","product":"Viñas del Tango Gran - Malbec","family":"Viñas del Tango"},
      {"code":"3000385","product":"Viñas del Tango Selection - Malbec","family":"Viñas del Tango"},
      {"code":"3000387","product":"Viñas del Tango Selection - Cabernet Sauvignon","family":"Viñas del Tango"},
      {"code":"452","product":"Viñas del Tango Malbec Premium","family":"Viñas del Tango"},
      {"code":"3000452","product":"Viñas del Tango Malbec Premium","family":"Viñas del Tango"},
      {"code":"3000191","product":"Cava Bonaval Brut Rosé - Garnacha","family":"Cava Bonaval"},
      {"code":"3000192","product":"Cava Bonaval Brut Branco - Macabeo","family":"Cava Bonaval"},
      {"code":"3000468","product":"Cava Bonaval Branca Brut Sleeve","family":"Cava Bonaval"},
      {"code":"3000251","product":"La Vache Espagnole Tto - Tempranillo, Monastrell","family":"La Vache"},
      {"code":"3000269","product":"La Vache Espagnole Bco - Macabeo","family":"La Vache"},
      {"code":"3000492","product":"Vinho Vidigal Rosé (6x750ml)","family":"Marques de Vitoria / Vidigal"},
      {"code":"3000491","product":"Vinho Prado Molar Tinto (6x750ml)","family":"Marques de Vitoria"},
      {"code":"3000490","product":"Vinho Marques de Vitoria Joven (6x750ml)","family":"Marques de Vitoria"},
      {"code":"3000489","product":"Vinho Marques de Vitoria Rosé (6x750ml)","family":"Marques de Vitoria"},
      {"code":"3000488","product":"Vinho Marques de Vitoria Blanco (6x750ml)","family":"Marques de Vitoria"},
      {"code":"3000487","product":"Vinho Marques de Vitoria Crianza (6x750ml)","family":"Marques de Vitoria"},
      {"code":"3000486","product":"Vinho Marques de Vitoria Reserva (6x750ml)","family":"Marques de Vitoria"},
      {"code":"3000485","product":"Vinho Marques de Vitoria Gran Reserva (6x750ml)","family":"Marques de Vitoria"},
      {"code":"3000476","product":"Vinho S.A Tto Stormhoek Pure Shiraz","family":"Stormhoek"},
      {"code":"3000475","product":"Vinho S.A Tto Stormhoek Cabernet/Merlot","family":"Stormhoek"},
      {"code":"3000474","product":"Vinho S.A Tto Stormhoek Syrah","family":"Stormhoek"},
      {"code":"3000473","product":"Vinho S.A Bco Stormhoek Sauvignon Blanc","family":"Stormhoek"},
      {"code":"3000472","product":"Vinho S.A Tto Stormhoek Pinotage","family":"Stormhoek"},
      {"code":"3000471","product":"Vinho S.A Tto Stormhoek Pinotage/Malbec","family":"Stormhoek"},
      {"code":"3000470","product":"Vinho S.A Bco Stormhoek Pinot Grigio","family":"Stormhoek"},
      {"code":"3000469","product":"Vinho S.A Bco Stormhoek Chard./Viognier","family":"Stormhoek"}
    ];

    /* ====== Catalog rendering (families) ====== */
    function escapeHtml(s){ return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function groupByFamily(items){
      const map = new Map();
      for(const p of items){
        const fam = (p.family || 'Outros').trim();
        if(!map.has(fam)) map.set(fam, []);
        map.get(fam).push(p);
      }
      return map;
    }

    const familiesEl = document.getElementById('families');
    const filterFamily = document.getElementById('filterFamily');
    const searchInput = document.getElementById('search');
    const totalCountEl = document.getElementById('totalCount');
    const familyCountEl = document.getElementById('familyCount');
    const btnShowAll = document.getElementById('btnShowAll');

    let grouped;
    function populateFilter(){
      grouped = groupByFamily(PRODUCTS);
      const families = Array.from(grouped.keys()).sort((a,b)=>a.localeCompare(b,'pt-BR'));
      filterFamily.innerHTML = '<option value="">Todas as famílias</option>';
      for(const f of families){
        const opt = document.createElement('option');
        opt.value = f;
        opt.textContent = f;
        filterFamily.appendChild(opt);
      }
      familyCountEl.textContent = families.length;
    }

    function createFamilyCard(family, items){
      const section = document.createElement('section');
      section.className = 'family';
      // Instead of wine photo, show the harmonization SVG icon (inline small version)
      const imgWrap = document.createElement('div');
      imgWrap.className = 'img';
      imgWrap.innerHTML = `
        <svg width="220" height="140" viewBox="0 0 220 140" role="img" aria-label="Ícone de harmonização">
          <rect width="100%" height="100%" rx="8" fill="#fff"/>
          <g transform="translate(20,10)">
            <circle cx="20" cy="30" r="18" fill="#fde68a" stroke="#f59e0b"/>
            <rect x="0" y="60" width="40" height="20" rx="4" fill="#f3f4f6"/>
            <text x="20" y="110" font-size="10" text-anchor="middle" fill="#374151">Chef</text>
          </g>
          <g transform="translate(90,10)">
            <circle cx="20" cy="30" r="18" fill="#fce7f3" stroke="#db2777"/>
            <rect x="6" y="60" width="28" height="20" rx="4" fill="#f3f4f6"/>
            <text x="20" y="110" font-size="10" text-anchor="middle" fill="#374151">Sommelier</text>
          </g>
          <g transform="translate(160,10)">
            <circle cx="20" cy="30" r="18" fill="#dbeafe" stroke="#2563eb"/>
            <rect x="0" y="60" width="40" height="20" rx="4" fill="#f3f4f6"/>
            <text x="20" y="110" font-size="10" text-anchor="middle" fill="#374151">Enólogo</text>
          </g>
        </svg>
      `;
      const h = document.createElement('h2');
      h.innerHTML = `${escapeHtml(family)} <span class="muted">(${items.length})</span>`;
      const ul = document.createElement('ul');
      ul.className = 'list';
      for(const it of items){
        const li = document.createElement('li');
        li.textContent = it.product;
        ul.appendChild(li);
      }
      section.appendChild(imgWrap);
      section.appendChild(h);
      section.appendChild(ul);
      return section;
    }

    function renderAll(selectedFamily = '', q = ''){
      familiesEl.innerHTML = '';
      const families = Array.from(grouped.keys()).sort((a,b)=>a.localeCompare(b,'pt-BR'));
      let shown = 0;
      for(const fam of families){
        if(selectedFamily && fam !== selectedFamily) continue;
        const items = grouped.get(fam).filter(p => !q || p.product.toLowerCase().includes(q));
        if(items.length === 0) continue;
        familiesEl.appendChild(createFamilyCard(fam, items));
        shown += items.length;
      }
      totalCountEl.textContent = shown;
      console.log('Renderizado', shown, 'rótulos (filtro:', selectedFamily || 'todas', 'pesquisa:', q || '—', ')');
    }

    filterFamily.addEventListener('change', ()=> renderAll(filterFamily.value, searchInput.value.trim().toLowerCase()));
    searchInput.addEventListener('input', ()=> renderAll(filterFamily.value, searchInput.value.trim().toLowerCase()));
    btnShowAll.addEventListener('click', ()=> { filterFamily.value = ''; searchInput.value = ''; renderAll(); });

    (function initCatalog(){
      try{
        if(!Array.isArray(PRODUCTS)) throw new Error('PRODUCTS não é um array.');
        populateFilter();
        renderAll();
        console.log('PRODUCTS length =', PRODUCTS.length);
      } catch(err){
        console.error('Erro inicializando catálogo:', err);
        familiesEl.innerHTML = '<div class="muted">Erro ao carregar catálogo. Veja console para detalhes.</div>';
      }
    })();

    /* ====== Harmonizador (TheMealDB) - mantém funcionalidade, usa o painel acima ====== */
    const WINES = Array.from(new Set(PRODUCTS.map(p => p.product))).slice(0, 200);
    const wineSelect = document.getElementById('wineSelectHarmo');
    const btnSearch = document.getElementById('btnSearchHarmo');
    const btnRandom = document.getElementById('btnRandomHarmo');
    const results = document.getElementById('results');
    const status = document.getElementById('status');

    (function populateWines(){
      wineSelect.innerHTML = '<option value="">— selecione um rótulo (ou deixe em branco para aleatório) —</option>';
      for(const w of WINES){
        const o = document.createElement('option');
        o.value = w;
        o.textContent = w;
        wineSelect.appendChild(o);
      }
    })();

    const API_KEY = '1';
    const BASE = `https://www.themealdb.com/api/json/v1/${API_KEY}`;

    async function fetchJson(url){
      const res = await fetch(url);
      if(!res.ok) throw new Error('Erro na requisição: ' + res.status);
      return res.json();
    }

    async function searchByName(q){
      const url = `${BASE}/search.php?s=${encodeURIComponent(q)}`;
      status.textContent = 'Buscando por nome: ' + q + ' ...';
      const json = await fetchJson(url);
      return json.meals;
    }

    async function filterByCategory(cat){
      const url = `${BASE}/filter.php?c=${encodeURIComponent(cat)}`;
      status.textContent = 'Fallback: buscando por categoria: ' + cat + ' ...';
      const json = await fetchJson(url);
      return json.meals;
    }

    async function lookupById(id){
      const url = `${BASE}/lookup.php?i=${encodeURIComponent(id)}`;
      const json = await fetchJson(url);
      return json.meals ? json.meals[0] : null;
    }

    function createMealCard(meal){
      const div = document.createElement('div');
      div.className = 'card';
      const thumb = meal.strMealThumb || '';
      const name = meal.strMeal || '—';
      const id = meal.idMeal || '';
      const source = meal.strSource || meal.strYoutube || '#';
      div.innerHTML = `
        <div style="display:flex;gap:12px;align-items:flex-start">
          <div style="flex:0 0 120px">
            <div class="thumb" aria-hidden="true">
              ${ thumb ? `<img src="${thumb}" alt="${escapeHtml(name)}" onerror="this.src='';this.parentNode.innerHTML='<div style=&quot;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#f3f4f6;color:#9ca3af&quot;>Imagem indisponível</div>'" />` : '<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#f3f4f6;color:#9ca3af">Imagem indisponível</div>' }
            </div>
          </div>
          <div style="flex:1">
            <h3 style="margin:0 0 6px">${escapeHtml(name)}</h3>
            <div class="muted">ID: ${escapeHtml(id)}</div>
            <div class="actions" style="margin-top:8px">
              <a class="badge" href="${source || '#'}" target="_blank" rel="noopener">Abrir receita</a>
              <button class="btnSuggest" style="padding:6px 10px;border-radius:6px">Sugerir Harmonização</button>
            </div>
            <div class="muted" style="margin-top:8px;font-size:0.95rem">Clique em "Sugerir Harmonização" para ver a proposta do Chef + Sommelier + Enólogo.</div>
            <div class="harmo-result" style="margin-top:10px"></div>
          </div>
        </div>
      `;
      const btn = div.querySelector('.btnSuggest');
      const harmoResult = div.querySelector('.harmo-result');
      btn.addEventListener('click', ()=>{
        // Simulação de sugestão colaborativa (exemplo simples)
        const suggestions = [
          `Chef: preparar o prato com redução cítrica; Sommelier: sugerir vinho branco fresco; Enólogo: destacar notas minerais.`,
          `Chef: grelhar levemente; Sommelier: vinho tinto leve; Enólogo: realçar taninos suaves.`,
          `Chef: usar ervas aromáticas; Sommelier: rosé jovem; Enólogo: acidez equilibrada.`
        ];
        const pick = suggestions[Math.floor(Math.random()*suggestions.length)];
        harmoResult.innerHTML = `<div style="background:#f8fafc;border:1px solid #e6eef8;padding:10px;border-radius:6px">${escapeHtml(pick)}</div>`;
      });
      return div;
    }

    function pickTopN(arr, n=3){ if(!Array.isArray(arr)) return []; return arr.slice(0,n); }

    async function findTop3ForWine(wineName){
      results.innerHTML = '';
      try{
        status.textContent = 'Iniciando busca...';
        if(wineName){
          const byName = await searchByName(wineName);
          if(byName && byName.length){
            status.textContent = `Encontradas ${byName.length} receitas por nome. Exibindo top 3.`;
            const top = pickTopN(byName, 3);
            for(const m of top) results.appendChild(createMealCard(m));
            return;
          }
        }

        const cat = 'Seafood';
        const byCat = await filterByCategory(cat);
        if(byCat && byCat.length){
          status.textContent = `Nenhuma receita por nome. Usando categoria "${cat}". Exibindo top 3.`;
          const top = pickTopN(byCat, 3);
          for(const item of top){
            const full = await lookupById(item.idMeal);
            results.appendChild(createMealCard(full || item));
          }
          return;
        }

        status.textContent = 'Nenhum prato encontrado; buscando aleatório...';
        const r = await fetch(`${BASE}/random.php`);
        const j = await r.json();
        if(j.meals && j.meals.length){
          status.textContent = 'Exibindo sugestão aleatória.';
          results.appendChild(createMealCard(j.meals[0]));
          return;
        }

        status.textContent = 'Nenhum prato encontrado.';
      } catch(err){
        console.error(err);
        status.textContent = 'Erro ao buscar: ' + (err.message || err);
      }
    }

    btnSearch.addEventListener('click', ()=> {
      const wine = wineSelect.value.trim();
      findTop3ForWine(wine);
    });

    btnRandom.addEventListener('click', async ()=>{
      results.innerHTML = '';
      status.textContent = 'Buscando 3 receitas aleatórias...';
      try{
        for(let i=0;i<3;i++){
          const r = await fetch(`${BASE}/random.php`);
          const j = await r.json();
          if(j.meals && j.meals[0]) results.appendChild(createMealCard(j.meals[0]));
        }
        status.textContent = 'Pronto — 3 receitas aleatórias.';
      } catch(e){
        console.error(e);
        status.textContent = 'Erro ao buscar aleatórias.';
      }
    });

    // inicial harmonizador
    (function initHarmonizador(){
      wineSelect.selectedIndex = 0;
      status.textContent = 'Pronto. Selecione um rótulo e clique em Buscar Top 3.';
    })();

    // expose for debugging
    window.PRODUCTS = PRODUCTS;
  </script>
</body>
</html>
